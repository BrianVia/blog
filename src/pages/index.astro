---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import BlogPostPreview from "../components/BlogPostPreview.astro";

let title = "The Journal";

// Use import.meta.glob to fetch all post with associated frontmatter
const posts = import.meta.glob("./posts/*.md", { eager: true });
const unsortedPosts = Object.values(posts);
const sortedPosts = unsortedPosts
  .filter((post) => post.frontmatter.published === true)
  .sort(function (a, b) {
    return new Date(b.frontmatter.pubDate).valueOf() - new Date(a.frontmatter.pubDate).valueOf();
  });
// slice first index and return modified original array
const finalSortedPosts = sortedPosts.length > 1 ? sortedPosts.slice(1) : [];
const mostRecentPost = sortedPosts.length > 0 ? sortedPosts[0] : null;
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <BaseHead title={title} />
  </head>

  <body>
    <Header />

    <main class="wrapper py-16 md:py-24">
      <!-- Hero Section -->
      <section class="text-center mb-24 md:mb-32">
        <h1 class="text-6xl md:text-8xl font-bold font-heading text-ink mb-8 tracking-tight leading-[0.9]">
          The Journal
        </h1>
        <div class="max-w-2xl mx-auto">
          <p class="text-2xl md:text-3xl font-serif italic text-ink-light">
            "I don't have talent, so I just get up earlier."
          </p>
          <p class="text-sm font-sans font-bold uppercase tracking-widest text-accent mt-4">
            â€” Henry Rollins
          </p>
        </div>
      </section>

      <!-- Featured Post -->
      {mostRecentPost && (
        <section id="most-recent-post" class="mb-24 md:mb-32">
           <div class="flex items-center gap-4 mb-8">
              <span class="h-px bg-ink/10 flex-1"></span>
              <h2 class="text-sm font-sans font-bold uppercase tracking-widest text-ink-lighter">Latest Entry</h2>
              <span class="h-px bg-ink/10 flex-1"></span>
           </div>
          <BlogPostPreview
            title={mostRecentPost.frontmatter.title}
            description={mostRecentPost.frontmatter.description || ""}
            pubDate={mostRecentPost.frontmatter.pubDate}
            url={`/posts/${mostRecentPost.frontmatter.slug}`}
            mostRecentPost={true}
            tags={mostRecentPost.frontmatter.tags || []}
          />
        </section>
      )}

      <!-- All Posts Grid (Masonry) -->
      <section aria-label="Blog post list">
         <div class="flex items-center gap-4 mb-12">
            <span class="h-px bg-ink/10 flex-1"></span>
            <h2 class="text-sm font-sans font-bold uppercase tracking-widest text-ink-lighter">Archive</h2>
            <span class="h-px bg-ink/10 flex-1"></span>
         </div>
        
        <div class="columns-1 md:columns-2 gap-12 space-y-12">
          {finalSortedPosts.map((post) => (
            <div class="break-inside-avoid">
              <BlogPostPreview
                title={post.frontmatter.title}
                description={post.frontmatter.description || ""}
                pubDate={post.frontmatter.pubDate}
                url={`/posts/${post.frontmatter.slug}`}
                tags={post.frontmatter.tags || []}
              />
            </div>
          ))}
        </div>
      </section>
    </main>

    <Footer />
  </body>
</html>
