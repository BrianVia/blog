---
import { Image } from "astro:assets";
import logoSvg from "../assets/logo.svg";
---

<header class="sticky top-0 z-50 w-full border-b border-ink/5 bg-paper/95 backdrop-blur transition-colors duration-500">
  <nav class="wrapper flex items-center justify-between py-5">
    <!-- Logo / Brand -->
    <a href="/" class="group flex items-center gap-3">
      <div class="relative overflow-hidden">
        <Image src={logoSvg} alt="Brian Via Logo" class="w-8 h-8 opacity-90 transition-transform duration-500 group-hover:rotate-12" />
      </div>
      <span class="font-heading font-bold text-2xl text-ink tracking-tight">
        Brian Via
      </span>
    </a>

    <!-- Desktop Nav -->
    <div class="hidden md:flex items-center gap-8">
      <a href="/" class="nav-link">Journal</a>
      <a href="/about" class="nav-link">About</a>
      <a href="/social" class="nav-link">Social</a>
      <a href="/feeds" class="nav-link">Feeds</a>
      <a href="/links" class="nav-link">Links</a>
      <a href="/books" class="nav-link">Library</a>
      
      <!-- Theme Toggle (Minimal) -->
      <button
        id="theme-toggle"
        class="ml-4 text-ink-lighter hover:text-accent transition-colors"
        aria-label="Toggle dark mode"
      >
        <svg class="sun-icon hidden dark:block w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="moon-icon block dark:hidden w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
    </div>

    <!-- Mobile Menu Button -->
    <div class="md:hidden flex items-center gap-4">
       <button
        id="theme-toggle-mobile"
        class="text-ink-lighter hover:text-accent transition-colors"
        aria-label="Toggle dark mode"
      >
        <svg class="sun-icon hidden dark:block w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="moon-icon block dark:hidden w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
      
      <button id="menu-toggle" class="text-ink hover:text-accent transition-colors" aria-label="Toggle menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu Dropdown -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-ink/5 bg-paper">
      <div class="flex flex-col p-6 gap-4">
        <a href="/" class="nav-link text-lg">Journal</a>
        <a href="/about" class="nav-link text-lg">About</a>
        <a href="/social" class="nav-link text-lg">Social</a>
        <a href="/feeds" class="nav-link text-lg">Feeds</a>
        <a href="/links" class="nav-link text-lg">Links</a>
        <a href="/books" class="nav-link text-lg">Library</a>
      </div>
  </div>
</header>

<script>
  function initTheme() {
    const theme = (() => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
      }
      return 'light';
    })();

    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    window.localStorage.setItem('theme', theme);
  }

  function handleToggleClick() {
    const element = document.documentElement;
    element.classList.toggle('dark');

    const isDark = element.classList.contains('dark');
    localStorage.setItem('theme', isDark ? 'dark' : 'light');
  }

  // Run on initial load
  initTheme();

  // Setup event listeners (Astro View Transitions compatible)
  document.addEventListener('astro:page-load', () => {
    const toggleBtn = document.getElementById('theme-toggle');
    const toggleBtnMobile = document.getElementById('theme-toggle-mobile');
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');

    toggleBtn?.addEventListener('click', handleToggleClick);
    toggleBtnMobile?.addEventListener('click', handleToggleClick);

    if (menuToggle && mobileMenu) {
      menuToggle.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }
  });
</script>
